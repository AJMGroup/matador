#!/usr/bin/env python
# coding: utf-8
""" This script mimics the dispersion.pl script bundled
with CASTEP. For the given bands file, a bandstructure
is created. If a <seed>.adaptive.dat file exists
then a combined BS/DOS plot will be created.
"""

from matador.plotting import plot_spectral
from os.path import isfile
import argparse

if __name__ == '__main__':
    parser = argparse.ArgumentParser(
        prog='dispersion',
        description='simple plotting script for bandstructures/DOS based on matador')

    parser = argparse.ArgumentParser(add_help=True)
    parser.add_argument('--pdf', action='store_true',
                        help='save pdf rather than showing plot in X')
    parser.add_argument('--png', action='store_true',
                        help='save png rather than showing plot in X')
    parser.add_argument('-g', '--gap', action='store_true',
                        help='plot position and size of band gap')
    parser.add_argument('-v', '--verbosity', type=int, default=0,
                        help='control verbosity of output')
    parser.add_argument('-pw', '--plot_window', type=float,
                        help='energy window to plot either side of E_F (eV)\
                             (DEFAULT: 5 eV)')
    parser.add_argument('seed', type=str, nargs='*',
                        help='seedname or bands file path')
    kwargs = vars(parser.parse_args())
    if 'gap' in kwargs:
        gap = kwargs['gap']
        del kwargs['gap']
    assert len(kwargs.get('seed')) >= 1, 'Seed name needed!'

    seed = kwargs.get('seed')
    test_seed = kwargs.get('seed')[0]
    verbosity = kwargs.get('verbosity')

    del kwargs['seed']
    del kwargs['verbosity']
    bs_seed = test_seed.replace('.bands', '') + '.bands'
    if isfile(bs_seed):
        bandstructure = True
    else:
        bandstructure = False
    dos_seed = test_seed.replace('.bands', '') + '.adaptive.dat'
    if isfile(dos_seed):
        dos = True
    else:
        dos = False
    cell_seed = test_seed.replace('.bands', '') + '.cell'
    if isfile(cell_seed):
        cell = True
    else:
        cell = False

    plot = plot_spectral(seed, plot_bandstructure=bandstructure, plot_dos=dos, cell=cell, gap=gap, verbosity=verbosity, **kwargs)
